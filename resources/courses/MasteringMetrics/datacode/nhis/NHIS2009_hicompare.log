
. 
. * PART I: Keep couples and select sample
. 
.         use NHIS2009_clean, clear

. 
.         * select non-missings
.                 keep if marradult==1 & perweight!=0 
(50,662 observations deleted)

.                         by serial: egen hi_hsb = mean(hi_hsb1)
(207 missing values generated)

.                                 keep if hi_hsb!=. & hi!=.
(207 observations deleted)

.                         by serial: egen numfem = total(fml)

.                                 keep if numfem==1
(31 observations deleted)

.                                 drop numfem

.                 
.         * Josh's sample selection criteria      
.                 gen angrist = ( age>=26 & age<=59 & marradult==
> 1 & adltempl>=1 )

.                         keep if angrist==1
(9,613 observations deleted)

.                 // drop single-person HHs
.                 by serial: gen n = _N

.                         keep if n>1
(1,331 observations deleted)

.                 
. * PART II: Create different datasets for husbands and wives
.         
.         preserve

.                 keep if fml == 1 
(9,395 observations deleted)

.                 save wives.dta, replace
file wives.dta saved

.         restore

.         
.         preserve

.                 keep if fml == 0 
(9,395 observations deleted)

.                 save husbands.dta, replace
file husbands.dta saved

.         restore 

.         
. * PART III: Create Table 1.1
.         
.         local groups "husbands wives"

. 
.         foreach g of local groups {
  2.                 
.         * Loop over husbands and wives datasets
.                 use `g', clear
  3.                 
.         * Prepare matrix to store results
.                 matrix results = J(15,3,.)
  4.                 matrix rownames results = "Health index" "se
> " "Nonwhite" "se" "Age" "se" "Education" "se" "Family Size" "se
> " "Employed" "se" "Family income" "se" "Sample size"
  5.                 if "`g'" == "husbands" { 
  6.                         matrix colnames results = "Husbands:
>  Some HI" "Husbands: No HI" "Husbands: Difference"
  7.                 }
  8.                 if "`g'" == "wives" { 
  9.                         matrix colnames results = "Wives: So
> me HI" "Wives: No HI" "Wives: Difference" 
 10.                 }
 11.                 
.                 matrix list results,format(%8.4f)
 12.                 
.                 local col = 1
 13.                 local row1 = 1
 14.                 local row2 = 2
 15.                 
. 
.          * Health status by insurance coverage and sex
.                 qui sum hlth if hi==1 /*& fml==`fem'*/ [ aw=per
> weight ]
 16.                         mat results[`row1',`col'] = r(mean)
 17.                         mat results[`row2',`col'] = r(sd)
 18.                         local ++col
 19.                         
.                 qui sum hlth if hi==0 /*& fml==`fem'*/ [ aw=per
> weight ]
 20.                         mat results[`row1',`col'] = r(mean)
 21.                         mat results[`row2',`col'] = r(sd)
 22.                         local ++col
 23. 
.                 reg hlth hi /*if fml==`fem'*/ [ aw=perweight ],
>  robust
 24.                         mat results[`row1',`col'] = _b[hi]
 25.                         mat results[`row2',`col'] = _se[hi]
 26.                         local ++col
 27.                         
.                         local row1 = `row1' + 2
 28.                         local row2 = `row2' + 2
 29. 
.         * Other characteristics by insurance and sex           
>  
.                 foreach var in nwhite age yedu famsize empl inc
>  {
 30.                         
.                         local col = 1
 31.                         
.                         * means and SDs
.                                 qui sum `var' if hi==1 /*& fml=
> =`fem'*/ [ aw=perweight ]
 32.                                         mat results[`row1',`
> col'] = r(mean)
 33.                                         local ++col
 34.                                 qui sum `var' if hi==0 /*& f
> ml==`fem'*/ [ aw=perweight ]
 35.                                         mat results[`row1',`
> col'] = r(mean)
 36.                                         local ++col
 37.                                         
.                         * mean comparisons 
.                                 reg `var' hi /*if fml==`fem'*/ 
> [ w=perweight ], robust
 38.                                         mat results[`row1',`
> col'] = _b[hi]
 39.                                         mat results[`row2',`
> col'] = _se[hi]
 40.                                         local ++col
 41.                                                             
>             
.                         local row1 = `row1' + 2
 42.                         local row2 = `row2' + 2
 43.                 }
 44.                         
.                 * Sample sizes
.                 tab hi /*if fml == 0*/ [aw=perweight], matcell(
> x)
 45.                 mat list x
 46.                 
.                 mat results[`row1',2] = x[1,1]
 47.                 mat results[`row1',1] = x[2,1]
 48. 
.         * List results
.         matrix list results, format(%8.2f)              
 49.                         
.                 
.         * Output results        
.         putexcel set MM_Table1_1, modify
 50.         if "`g'" == "husbands" {
 51.                 putexcel A1 = matrix(results), names nformat
> (number_d2)
 52.         }
 53.         if "`g'" == "wives" {
 54.                 putexcel E1 = matrix(results), overwritefmt 
> colnames nformat(number_d2) 
 55.         }
 56.         
.         }

results[15,3]
                Husbands:   Husbands:   Husbands:
                 Some HI       No HI  Difference
Health index           .           .           .
          se           .           .           .
    Nonwhite           .           .           .
          se           .           .           .
         Age           .           .           .
          se           .           .           .
   Education           .           .           .
          se           .           .           .
 Family Size           .           .           .
          se           .           .           .
    Employed           .           .           .
          se           .           .           .
Family inc~e           .           .           .
          se           .           .           .
 Sample size           .           .           .
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      84.68
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0129
                                                Root MSE         
>  =      .9406

-----------------------------------------------------------------
> -------------
             |               Robust
        hlth | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   .3132452   .0340396     9.20   0.000     .246520
> 2                                                              
>      .3799702
       _cons |   3.695654   .0316859   116.63   0.000     3.63354
> 3                                                              
>      3.757765
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =       1.01
                                                Prob > F         
>  =     0.3144
                                                R-squared        
>  =     0.0001
                                                Root MSE         
>  =     .36602

-----------------------------------------------------------------
> -------------
             |               Robust
      nwhite | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |  -.0115948   .0115249    -1.01   0.314     -.03418
> 6                                                              
>      .0109965
       _cons |   .1693667   .0106274    15.94   0.000     .148534
> 7                                                              
>      .1901986
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      86.70
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0114
                                                Root MSE         
>  =      8.661

-----------------------------------------------------------------
> -------------
             |               Robust
         age | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   2.713743   .2914405     9.31   0.000     2.14245
> 7                                                              
>      3.285029
       _cons |   41.26318   .2671254   154.47   0.000     40.7395
> 6                                                              
>      41.78681
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =     729.63
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.1129
                                                Root MSE         
>  =       2.64

-----------------------------------------------------------------
> -------------
             |               Robust
        yedu | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   2.743283   .1015592    27.01   0.000     2.54420
> 5                                                              
>      2.942361
       _cons |   11.56244   .0962655   120.11   0.000     11.3737
> 4                                                              
>      11.75115
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      81.36
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0147
                                                Root MSE         
>  =     1.3262

-----------------------------------------------------------------
> -------------
             |               Robust
     famsize | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |  -.4721901   .0523507    -9.02   0.000    -.574808
> 9                                                              
>     -.3695713
       _cons |   3.976924   .0494789    80.38   0.000     3.87993
> 4                                                              
>      4.073913
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      40.01
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0084
                                                Root MSE         
>  =     .27911

-----------------------------------------------------------------
> -------------
             |               Robust
        empl | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   .0748071   .0118272     6.33   0.000     .051623
> 3                                                              
>       .097991
       _cons |    .849466   .0112809    75.30   0.000     .827352
> 9                                                              
>      .8715791
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 34,118,563)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =    2011.74
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.1380
                                                Root MSE         
>  =      52163

-----------------------------------------------------------------
> -------------
             |               Robust
         inc | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   60810.44   1355.789    44.85   0.000      58152.
> 8                                                              
>      63468.08
       _cons |   45656.25   1149.919    39.70   0.000     43402.1
> 6                                                              
>      47910.34
-----------------------------------------------------------------
> -------------

         hi |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,281.4929       13.64       13.64
          1 | 8,113.5071       86.36      100.00
------------+-----------------------------------
      Total |      9,395      100.00

x[2,1]
           c1
r1  1281.4929
r2  8113.5071

results[15,3]
                Husbands:   Husbands:   Husbands:
                 Some HI       No HI  Difference
Health index        4.01        3.70        0.31
          se        0.93        1.01        0.03
    Nonwhite        0.16        0.17       -0.01
          se           .           .        0.01
         Age       43.98       41.26        2.71
          se           .           .        0.29
   Education       14.31       11.56        2.74
          se           .           .        0.10
 Family Size        3.50        3.98       -0.47
          se           .           .        0.05
    Employed        0.92        0.85        0.07
          se           .           .        0.01
Family inc~e     1.1e+05    45656.25    60810.44
          se           .           .     1355.79
 Sample size     8113.51     1281.49           .
file MM_Table1_1.xlsx saved

results[15,3]
                   Wives:      Wives:      Wives:
                 Some HI       No HI  Difference
Health index           .           .           .
          se           .           .           .
    Nonwhite           .           .           .
          se           .           .           .
         Age           .           .           .
          se           .           .           .
   Education           .           .           .
          se           .           .           .
 Family Size           .           .           .
          se           .           .           .
    Employed           .           .           .
          se           .           .           .
Family inc~e           .           .           .
          se           .           .           .
 Sample size           .           .           .
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =     125.33
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0186
                                                Root MSE         
>  =      .9314

-----------------------------------------------------------------
> -------------
             |               Robust
        hlth | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   .3943197   .0352229    11.19   0.000     .325275
> 2                                                              
>      .4633642
       _cons |   3.623059   .0330162   109.74   0.000      3.5583
> 4                                                              
>      3.687778
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =       3.63
                                                Prob > F         
>  =     0.0569
                                                R-squared        
>  =     0.0005
                                                Root MSE         
>  =     .36063

-----------------------------------------------------------------
> -------------
             |               Robust
      nwhite | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |  -.0239163   .0125603    -1.90   0.057    -.048537
> 1                                                              
>      .0007046
       _cons |   .1747474    .011823    14.78   0.000     .151571
> 6                                                              
>      .1979231
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      75.56
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0094
                                                Root MSE         
>  =     8.7488

-----------------------------------------------------------------
> -------------
             |               Robust
         age | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   2.619479   .3013479     8.69   0.000     2.02877
> 2                                                              
>      3.210186
       _cons |   39.61744   .2768904   143.08   0.000     39.0746
> 7                                                              
>       40.1602
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =     609.62
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.1030
                                                Root MSE         
>  =     2.5386

-----------------------------------------------------------------
> -------------
             |               Robust
        yedu | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   2.642903   .1070412    24.69   0.000     2.43307
> 9                                                              
>      2.852727
       _cons |   11.79908   .1026488   114.95   0.000     11.5978
> 7                                                              
>      12.00029
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =      65.13
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0112
                                                Root MSE         
>  =     1.3215

-----------------------------------------------------------------
> -------------
             |               Robust
     famsize | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   -.432758   .0536228    -8.07   0.000    -.537870
> 4                                                              
>     -.3276457
       _cons |   3.926348   .0507972    77.29   0.000     3.82677
> 5                                                              
>      4.025922
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =     151.32
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.0238
                                                Root MSE         
>  =      .4332

-----------------------------------------------------------------
> -------------
             |               Robust
        empl | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |   .2076896   .0168834    12.30   0.000     .174594
> 5                                                              
>      .2407848
       _cons |   .5577617   .0159292    35.01   0.000     .526536
> 9                                                              
>      .5889864
-----------------------------------------------------------------
> -------------
(analytic weights assumed)
(sum of wgt is 32,513,646)

Linear regression                               Number of obs    
>  =      9,395
                                                F(1, 9393)       
>  =    1810.42
                                                Prob > F         
>  =     0.0000
                                                R-squared        
>  =     0.1207
                                                Root MSE         
>  =      52556

-----------------------------------------------------------------
> -------------
             |               Robust
         inc | Coefficient  std. err.      t    P>|t|     [95% co
> n                                                              
>  f. interval]
-------------+---------------------------------------------------
> -------------
          hi |    59827.5   1406.084    42.55   0.000     57071.2
> 7                                                              
>      62583.73
       _cons |    46384.7     1208.8    38.37   0.000     44015.1
> 9                                                              
>      48754.21
-----------------------------------------------------------------
> -------------

         hi |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 1,131.3788       12.04       12.04
          1 | 8,263.6212       87.96      100.00
------------+-----------------------------------
      Total |      9,395      100.00

x[2,1]
           c1
r1  1131.3788
r2  8263.6212

results[15,3]
                   Wives:      Wives:      Wives:
                 Some HI       No HI  Difference
Health index        4.02        3.62        0.39
          se        0.92        1.01        0.04
    Nonwhite        0.15        0.17       -0.02
          se           .           .        0.01
         Age       42.24       39.62        2.62
          se           .           .        0.30
   Education       14.44       11.80        2.64
          se           .           .        0.11
 Family Size        3.49        3.93       -0.43
          se           .           .        0.05
    Employed        0.77        0.56        0.21
          se           .           .        0.02
Family inc~e     1.1e+05    46384.70    59827.50
          se           .           .     1406.08
 Sample size     8263.62     1131.38           .
file MM_Table1_1.xlsx saved

.         
. cap log close
