---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\chadi\OneDrive - Handelshögskolan i Stockholm\SU\EC38003\assignments\PS4\Econometrics II - Problem Set 4 - Suggested Solutions\log/PS4_Q1.log
  log type:  text
 opened on:   9 May 2024, 13:26:27

. 
. 
. set scheme lean2

. 
. 
. set seed 508

. 
. 
. * Q1.6 =======================================
. 
. * generate data
. ** villages
. set obs 100 // villages
Number of observations (_N) was 0, now 100.

. 
. gen j = _n

. gen d = runiform() > .5

. gen mu_j = rnormal(2,1)

. 
. *** save for later use
. save tmp/mu, replace
(file tmp/mu.dta not found)
file tmp/mu.dta saved

. 
. 
. ** individuals
. expand 10 // individuals
(900 observations created)

. 
. bys j: gen i = _n

. 
. gen w = runiform() > .5

. 
. gen y00 = rnormal(0, 1)

. gen y10 = rnormal(1, 1)

. gen y01 = rnormal(mu_j, 1)

. 
. 
. cap program drop sample_phi

. program define sample_phi, 
  1.   syntax[, phi(real 0)]
  2. 
.   keep j - y01  
  3.   gen x = rnormal(`phi', 0.2)
  4.   gen y11 = y10 + y01 + x
  5. 
.   gen y = (1-d)*(1-w)*y00 ///
>     + d*(1-w)*y10 ///
>     + (1-d)*w*y01 ///
>     + d*w*y11
  6. 
. end

. 
. 
. forvalues phi = -1(.2)1 {
  2.         
.   sample_phi, phi(`phi')
  3.         reg y d w, cl(j)
  4.         
.         mat d_coef_s1 = [nullmat(d_coef_s1) \ _b[d]]
  5.         mat d_se_s1 = [nullmat(d_se_s1) \ _se[d]]
  6.         mat w_coef_s1 = [nullmat(w_coef_s1) \ _b[w]]
  7.         mat w_se_s1 = [nullmat(w_se_s1) \ _se[w]]
  8. 
.         gen dw = d*w
  9.         reg y d w dw, cl(j)
 10.         
.         mat d_coef_s2 = [nullmat(d_coef_s2) \ _b[d]]
 11.         mat d_se_s2 = [nullmat(d_se_s2) \ _se[d]]
 12.         mat w_coef_s2 = [nullmat(w_coef_s2) \ _b[w]]
 13.         mat w_se_s2 = [nullmat(w_se_s2) \ _se[w]]
 14.         
.         mat phis = [nullmat(phis) \ round(`phi', .1)]
 15.         
. }

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =      62.23
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2520
                                                Root MSE          =     1.3451

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   .5257432   .1299233     4.05   0.000     .2679471    .7835392
           w |   1.493053   .1383386    10.79   0.000     1.218559    1.767547
       _cons |   .2347323   .0797109     2.94   0.004     .0765686     .392896
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     101.21
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2841
                                                Root MSE          =     1.3166

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -1.128436   .2607832    -4.33   0.000    -1.645886    -.610985
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =      75.21
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2820
                                                Root MSE          =     1.3286

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   .6211244   .1284647     4.83   0.000     .3662226    .8760263
           w |   1.572349   .1342113    11.72   0.000     1.306044    1.838653
       _cons |   .1926235   .0776394     2.48   0.015     .0385701     .346677
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     106.51
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3039
                                                Root MSE          =     1.3088

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -.9399962   .2589581    -3.63   0.000    -1.453825   -.4261672
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =      91.16
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3138
                                                Root MSE          =     1.3232

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   .7329361   .1284656     5.71   0.000     .4780324    .9878398
           w |   1.665304   .1304483    12.77   0.000     1.406466    1.924142
       _cons |   .1432611   .0757902     1.89   0.062    -.0071231    .2936453
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     112.54
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3261
                                                Root MSE          =     1.3119

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -.7190962   .2578848    -2.79   0.006    -1.230796   -.2073969
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =      99.22
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3386
                                                Root MSE          =     1.3217

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   .8230842    .131459     6.26   0.000      .562241    1.083927
           w |   1.740249   .1302253    13.36   0.000     1.481854    1.998644
       _cons |   .1034627   .0757049     1.37   0.175    -.0467522    .2536775
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     115.68
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3454
                                                Root MSE          =     1.3156

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -.5409957   .2632267    -2.06   0.042    -1.063295   -.0186969
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     120.16
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3711
                                                Root MSE          =     1.3094

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   .9280473   .1287646     7.21   0.000     .6725504    1.183544
           w |   1.827511   .1266342    14.43   0.000     1.576241     2.07878
       _cons |   .0571237   .0740381     0.77   0.442    -.0897839    .2040314
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     124.99
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3736
                                                Root MSE          =     1.3075

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -.3336261    .258025    -1.29   0.199    -.8456037    .1783516
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     132.38
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3949
                                                Root MSE          =     1.3183

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.029925   .1300011     7.92   0.000     .7719742    1.287875
           w |   1.912207    .126691    15.09   0.000     1.660824    2.163589
       _cons |   .0121471   .0741796     0.16   0.870    -.1350413    .1593355
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     131.66
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3953
                                                Root MSE          =     1.3185

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |  -.1323529   .2606492    -0.51   0.613    -.6495375    .3848316
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     146.35
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4195
                                                Root MSE          =     1.3182

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.124871   .1310343     8.58   0.000     .8648702    1.384871
           w |   1.991141   .1261972    15.78   0.000     1.740738    2.241543
       _cons |  -.0297696   .0740884    -0.40   0.689    -.1767771     .117238
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     137.73
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4196
                                                Root MSE          =     1.3187

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |   .0552269   .2596247     0.21   0.832     -.459925    .5703787
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     161.08
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4480
                                                Root MSE          =     1.3096

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |    1.22525   .1311539     9.34   0.000     .9650127    1.485488
           w |   2.074592   .1266059    16.39   0.000     1.823379    2.325806
       _cons |   -.074085   .0744809    -0.99   0.322    -.2218712    .0737012
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     146.68
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4493
                                                Root MSE          =     1.3087

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |   .2535414   .2590457     0.98   0.330    -.2604616    .7675443
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     179.12
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4738
                                                Root MSE          =     1.3142

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.338184   .1306111    10.25   0.000     1.079023    1.597344
           w |    2.16848   .1275408    17.00   0.000     1.915411    2.421548
       _cons |  -.1239426   .0751988    -1.65   0.102    -.2731535    .0252682
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     159.32
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4780
                                                Root MSE          =     1.3096

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |   .4766573   .2571722     1.85   0.067    -.0336282    .9869428
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     191.23
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4947
                                                Root MSE          =      1.321

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.438521   .1307711    11.00   0.000     1.179043    1.697999
           w |   2.251896   .1298487    17.34   0.000     1.994248    2.509544
       _cons |  -.1682394   .0765842    -2.20   0.030     -.320199   -.0162798
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     170.44
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5027
                                                Root MSE          =     1.3111

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |    .674888   .2574564     2.62   0.010     .1640385    1.185737
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     192.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5133
                                                Root MSE          =     1.3317

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.539236   .1340522    11.48   0.000     1.273247    1.805224
           w |   2.335626   .1343137    17.39   0.000     2.069118    2.602133
       _cons |  -.2127028   .0790385    -2.69   0.008    -.3695323   -.0558734
------------------------------------------------------------------------------

Linear regression                               Number of obs     =      1,000
                                                F(3, 99)          =     175.68
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5261
                                                Root MSE          =     1.3148

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.096917   .0827335    13.26   0.000     .9327557    1.261078
           w |   1.967901   .1588531    12.39   0.000     1.652702      2.2831
          dw |   .8738647   .2619374     3.34   0.001     .3541242    1.393605
       _cons |  -.0174285   .0603883    -0.29   0.773    -.1372519    .1023949
------------------------------------------------------------------------------

. 
. forval k = 1/2 {
  2.         foreach var in d w {
  3.                 mat lb_`var'_s`k' = `var'_coef_s`k' - 1.96*`var'_se_s`k'
  4.                 mat ub_`var'_s`k' = `var'_coef_s`k' + 1.96*`var'_se_s`k'
  5.         }
  6. }

. 
. 
. forval k = 1/2 {
  2.         foreach var in d w {
  3.                 svmat `var'_coef_s`k'
  4.                 svmat lb_`var'_s`k'
  5.                 svmat ub_`var'_s`k'
  6.         }
  7. }

. svmat phis

. 
. * without interaction
. twoway (rcap ub_d_s11 lb_d_s11 phis1, lcolor(navy)) ///
>         (connected d_coef_s11 phis1, mcolor(navy) msymbol(O) lcolor(navy)) ///
>         (rcap ub_w_s11 lb_w_s11 phis1, lcolor(orange)) ///
>         (connected w_coef_s11 phis1, mcolor(orange) msymbol(S) lcolor(orange) yaxis(1 2)), ///
>         yline(1, lcolor(navy%20)   axis(2)) ///
>         yline(2, lcolor(orange%20)  axis(2)) ///
>   legend(order(2 "`=ustrunescape("\u03C4\u0302")'{sub:d}" ///
>                4 "`=ustrunescape("\u03C4\u0302")'{sub:w}") position(6) row(1)) ///
>   xtitle("{&phi}") ylabel(1 "{&tau}{sub:d}" 2 "{&tau}{sub:w}")

. graph export output/Fig_1_6_nointer.png, replace
(file output/Fig_1_6_nointer.png not found)
file output/Fig_1_6_nointer.png saved as PNG format

. 
. * with interaction
. twoway (rcap ub_d_s21 lb_d_s21 phis1, lcolor(navy)) ///
>         (connected d_coef_s21 phis1, mcolor(navy) msymbol(O) lcolor(navy)) ///
>         (rcap ub_w_s21 lb_w_s21 phis1, lcolor(orange)) ///
>         (connected w_coef_s21 phis1, mcolor(orange) msymbol(S) lcolor(orange) yaxis(1 2)), ///
>   ylabel(0.5(0.5)2.5, axis(2)) ///
>         yline(1, lcolor(navy%20) axis(2)) ///
>         yline(2, lcolor(orange%20) axis(2)) ///
>   legend(order(2 "`=ustrunescape("\u03C4\u0302")'{sub:d}" ///
>               4 "`=ustrunescape("\u03C4\u0302")'{sub:w}") position(6) row(1)) ///
>   xtitle("{&phi}") ylabel(1 "{&tau}{sub:d}" 2 "{&tau}{sub:w}", axis(1))

. graph export output/Fig_1_6_inter.png, replace
(file output/Fig_1_6_inter.png not found)
file output/Fig_1_6_inter.png saved as PNG format

. 
. 
. 
. 
. * Q1.7 =======================================
. 
. label variable d "\$D_j\$"

. label variable w "\$W_{ij}\$"

. 
. 
. eststo clear

. forvalues i = 0/1 {
  2.   qui sample_phi, phi(`i')
  3. 
.   * run regressions
.   eststo: reg y d w, cl(j)
  4.   eststo: reghdfe y w, absorb(j) cluster(j)
  5. }

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     130.13
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3925
                                                Root MSE          =      1.316

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.017726   .1308074     7.78   0.000     .7581762    1.277277
           w |   1.902066   .1266575    15.02   0.000      1.65075    2.153382
       _cons |   .0175323   .0741474     0.24   0.814    -.1295923    .1646569
------------------------------------------------------------------------------
(est1 stored)
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =      1,000
Absorbing 1 HDFE group                            F(   1,     99) =     235.13
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.5361
                                                  Adj R-squared   =     0.4845
                                                  Within R-sq.    =     0.3778
Number of clusters (j)       =        100         Root MSE        =     1.2110

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           w |   1.884271   .1228829    15.33   0.000     1.640445    2.128098
       _cons |   .4541061    .063039     7.20   0.000     .3290231     .579189
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
           j |       100         100           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(est2 stored)

Linear regression                               Number of obs     =      1,000
                                                F(2, 99)          =     198.97
                                                Prob > F          =     0.0000
                                                R-squared         =     0.5121
                                                Root MSE          =     1.3287

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           d |   1.528614   .1316969    11.61   0.000     1.267298    1.789929
           w |   2.326795   .1327829    17.52   0.000     2.063325    2.590265
       _cons |  -.2080134   .0782705    -2.66   0.009    -.3633191   -.0527077
------------------------------------------------------------------------------
(est3 stored)
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =      1,000
Absorbing 1 HDFE group                            F(   1,     99) =     326.04
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.6269
                                                  Adj R-squared   =     0.5854
                                                  Within R-sq.    =     0.4717
Number of clusters (j)       =        100         Root MSE        =     1.2236

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           w |   2.308466   .1278461    18.06   0.000     2.054792     2.56214
       _cons |    .443407    .065585     6.76   0.000      .313272    .5735419
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
           j |       100         100           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(est4 stored)

. 
. 
. esttab using output/Tab_1_7.tex, ///
>   cells(b(fmt(4)) se(par)) collabels(none) ///
>   label replace keep(d w) ///
>   mtitles("No Village FE" "Village FE" "No Village FE" "Village FE") ///
>   mgroups("$\phi = 0$" "$\phi = 1$", pattern(1 0 1 0) ///
>           prefix(\multicolumn{@span}{c}{) suffix(}) ///
>                   span erepeat(\cmidrule(lr){@span})) ///
>   substitute(\_ _)
(file output/Tab_1_7.tex not found)
(output written to output/Tab_1_7.tex)

.         
. 
. 
. * Q1.8 =======================================
. 
. qui sample_phi, phi(0)

. 
. gen tau_j = j*w

. reghdfe y ib0.tau_j, absorb(j) cluster(j)
(MWFE estimator converged in 1 iterations)
warning: missing F statistic; dropped variables due to collinearity or too few clusters

HDFE Linear regression                            Number of obs   =      1,000
Absorbing 1 HDFE group                            F( 100,     99) =          .
Statistics robust to heteroskedasticity           Prob > F        =          .
                                                  R-squared       =     0.6545
                                                  Adj R-squared   =     0.5686
                                                  Within R-sq.    =     0.5358
Number of clusters (j)       =        100         Root MSE        =     1.1067

                                    (Std. err. adjusted for 100 clusters in j)
------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       tau_j |
          1  |   1.687208   7.49e-16  2.3e+15   0.000     1.687208    1.687208
          2  |   1.991991   1.25e-15  1.6e+15   0.000     1.991991    1.991991
          3  |   2.311801   4.05e-15  5.7e+14   0.000     2.311801    2.311801
          4  |   3.482751   1.60e-15  2.2e+15   0.000     3.482751    3.482751
          5  |   4.325186   4.21e-15  1.0e+15   0.000     4.325186    4.325186
          6  |   3.501708   6.00e-15  5.8e+14   0.000     3.501708    3.501708
          7  |   1.160323   2.28e-15  5.1e+14   0.000     1.160323    1.160323
          8  |   1.837343   1.16e-16  1.6e+16   0.000     1.837343    1.837343
          9  |     1.7891   1.10e-15  1.6e+15   0.000       1.7891      1.7891
         10  |  -1.232385   2.15e-16 -5.7e+15   0.000    -1.232385   -1.232385
         11  |   .4560497   4.20e-17  1.1e+16   0.000     .4560497    .4560497
         12  |   3.812834   3.83e-16  1.0e+16   0.000     3.812834    3.812834
         13  |   .9720308   2.33e-16  4.2e+15   0.000     .9720308    .9720308
         14  |   2.670953   6.74e-16  4.0e+15   0.000     2.670953    2.670953
         15  |   3.716546   1.42e-17  2.6e+17   0.000     3.716546    3.716546
         16  |    1.83574   4.32e-16  4.2e+15   0.000      1.83574     1.83574
         17  |   2.138786   2.77e-16  7.7e+15   0.000     2.138786    2.138786
         18  |   3.377198   5.83e-17  5.8e+16   0.000     3.377198    3.377198
         19  |    1.36194   2.02e-16  6.8e+15   0.000      1.36194     1.36194
         20  |  -.2384835   1.49e-16 -1.6e+15   0.000    -.2384835   -.2384835
         21  |    1.84501   5.74e-16  3.2e+15   0.000      1.84501     1.84501
         22  |   .4781071   1.36e-16  3.5e+15   0.000     .4781071    .4781071
         23  |   3.870639   1.77e-16  2.2e+16   0.000     3.870639    3.870639
         24  |   2.271578   4.04e-16  5.6e+15   0.000     2.271578    2.271578
         25  |   1.890562   6.82e-16  2.8e+15   0.000     1.890562    1.890562
         26  |   2.894345   7.46e-16  3.9e+15   0.000     2.894345    2.894345
         27  |   1.013741   2.04e-16  5.0e+15   0.000     1.013741    1.013741
         28  |   .1640945   1.26e-16  1.3e+15   0.000     .1640945    .1640945
         29  |   3.328388   2.24e-16  1.5e+16   0.000     3.328388    3.328388
         30  |   2.653345   2.22e-16  1.2e+16   0.000     2.653345    2.653345
         31  |   .9648635   1.07e-16  9.0e+15   0.000     .9648635    .9648635
         32  |   2.979843   1.36e-16  2.2e+16   0.000     2.979843    2.979843
         33  |   1.913607   2.61e-16  7.3e+15   0.000     1.913607    1.913607
         34  |   2.387731   1.48e-15  1.6e+15   0.000     2.387731    2.387731
         35  |   2.633398   2.74e-16  9.6e+15   0.000     2.633398    2.633398
         36  |  -.8540179   2.84e-18 -3.0e+17   0.000    -.8540179   -.8540179
         37  |   .1674224   3.47e-17  4.8e+15   0.000     .1674224    .1674224
         38  |   1.838707   2.46e-16  7.5e+15   0.000     1.838707    1.838707
         39  |   1.154769   4.24e-16  2.7e+15   0.000     1.154769    1.154769
         40  |   2.983215   7.52e-16  4.0e+15   0.000     2.983215    2.983215
         41  |   1.065351   2.18e-16  4.9e+15   0.000     1.065351    1.065351
         42  |   2.420117   1.01e-15  2.4e+15   0.000     2.420117    2.420117
         43  |   3.096235   3.18e-16  9.7e+15   0.000     3.096235    3.096235
         44  |   2.890278   1.02e-15  2.8e+15   0.000     2.890278    2.890278
         45  |   .9487247   1.44e-16  6.6e+15   0.000     .9487247    .9487247
         46  |   2.733367   6.56e-16  4.2e+15   0.000     2.733367    2.733367
         47  |   3.816488   1.89e-16  2.0e+16   0.000     3.816488    3.816488
         48  |   1.898216   1.03e-16  1.8e+16   0.000     1.898216    1.898216
         49  |    1.51977   2.64e-17  5.7e+16   0.000      1.51977     1.51977
         50  |   1.651965   1.40e-16  1.2e+16   0.000     1.651965    1.651965
         51  |   .8203605   1.43e-16  5.7e+15   0.000     .8203605    .8203605
         52  |  -.2465884   1.01e-17 -2.4e+16   0.000    -.2465884   -.2465884
         53  |   2.854682   9.18e-16  3.1e+15   0.000     2.854682    2.854682
         54  |   1.016654   2.52e-17  4.0e+16   0.000     1.016654    1.016654
         55  |   2.961018   8.24e-16  3.6e+15   0.000     2.961018    2.961018
         56  |   .5906233   3.93e-17  1.5e+16   0.000     .5906233    .5906233
         57  |   3.123165   4.93e-16  6.3e+15   0.000     3.123165    3.123165
         58  |   3.255504   5.43e-16  6.0e+15   0.000     3.255504    3.255504
         59  |   1.885136   1.32e-16  1.4e+16   0.000     1.885136    1.885136
         60  |   3.533364   1.38e-17  2.6e+17   0.000     3.533364    3.533364
         61  |   1.932887   6.17e-16  3.1e+15   0.000     1.932887    1.932887
         62  |   .9473529   4.02e-16  2.4e+15   0.000     .9473529    .9473529
         63  |   4.670952   1.25e-15  3.7e+15   0.000     4.670952    4.670952
         64  |   1.203078   1.18e-16  1.0e+16   0.000     1.203078    1.203078
         65  |   .4318087   7.32e-18  5.9e+16   0.000     .4318087    .4318087
         66  |   .8232656   9.29e-17  8.9e+15   0.000     .8232656    .8232656
         67  |   3.411908   1.27e-15  2.7e+15   0.000     3.411908    3.411908
         68  |   1.236976   1.72e-16  7.2e+15   0.000     1.236976    1.236976
         69  |    1.56574   1.25e-16  1.3e+16   0.000      1.56574     1.56574
         70  |   2.190431   3.84e-16  5.7e+15   0.000     2.190431    2.190431
         71  |   3.017072   5.99e-16  5.0e+15   0.000     3.017072    3.017072
         72  |   1.939863   6.70e-16  2.9e+15   0.000     1.939863    1.939863
         73  |  -.5764499   3.96e-16 -1.5e+15   0.000    -.5764499   -.5764499
         74  |   2.466421   8.82e-16  2.8e+15   0.000     2.466421    2.466421
         75  |   1.663335   2.50e-16  6.7e+15   0.000     1.663335    1.663335
         76  |   3.386745   1.82e-16  1.9e+16   0.000     3.386745    3.386745
         77  |   .7300047   2.18e-17  3.4e+16   0.000     .7300047    .7300047
         78  |    3.05833   1.76e-16  1.7e+16   0.000      3.05833     3.05833
         79  |  -.2631787   2.48e-17 -1.1e+16   0.000    -.2631787   -.2631787
         80  |   1.867156   6.18e-16  3.0e+15   0.000     1.867156    1.867156
         81  |   2.950926   6.02e-16  4.9e+15   0.000     2.950926    2.950926
         82  |   1.572045   1.37e-16  1.1e+16   0.000     1.572045    1.572045
         83  |   1.026806   2.93e-16  3.5e+15   0.000     1.026806    1.026806
         84  |   .8650176   1.75e-16  4.9e+15   0.000     .8650176    .8650176
         85  |   2.513226   3.19e-17  7.9e+16   0.000     2.513226    2.513226
         86  |   1.561963   1.57e-17  9.9e+16   0.000     1.561963    1.561963
         87  |   4.851578   3.84e-16  1.3e+16   0.000     4.851578    4.851578
         88  |   2.092898   1.76e-16  1.2e+16   0.000     2.092898    2.092898
         89  |   1.864683   3.26e-16  5.7e+15   0.000     1.864683    1.864683
         90  |   .3798856   7.53e-17  5.0e+15   0.000     .3798856    .3798856
         91  |   1.683419   5.70e-18  3.0e+17   0.000     1.683419    1.683419
         92  |   1.559233   1.32e-16  1.2e+16   0.000     1.559233    1.559233
         93  |   1.734065   1.46e-16  1.2e+16   0.000     1.734065    1.734065
         94  |   2.368494   1.38e-16  1.7e+16   0.000     2.368494    2.368494
         95  |    .731516   1.45e-16  5.0e+15   0.000      .731516     .731516
         96  |   1.283606   1.93e-16  6.7e+15   0.000     1.283606    1.283606
         97  |   2.078079   6.25e-17  3.3e+16   0.000     2.078079    2.078079
         98  |    2.02713   1.03e-15  2.0e+15   0.000      2.02713     2.02713
         99  |    .355061   4.57e-17  7.8e+15   0.000      .355061     .355061
        100  |   1.600233   6.30e-16  2.5e+15   0.000     1.600233    1.600233
             |
       _cons |   .4289633   7.32e-17  5.9e+15   0.000     .4289633    .4289633
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
           j |       100         100           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. preserve

.   regsave

. 
.   keep var coef

.   rename coef tau_j

. 
.   gen j = regexs(1) if regexm(var, "([0-9]+).*")
(1 missing value generated)

.   drop var

. 
.   destring j, replace
j: all characters numeric; replaced as byte
(1 missing value generated)

. 
.   drop if j < 1 | j > 100
(2 observations deleted)

. 
.   merge 1:1 j using tmp/mu, nogen
(variable j was byte, now float to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               100  
    -----------------------------------------

. 
.   sum mu_j, d

                            mu_j
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.1978489      -.5243578
 5%     .3300017         .12866
10%     .6234754       .1639596       Obs                 100
25%     1.284459       .2713039       Sum of wgt.         100

50%     2.005636                      Mean           1.952151
                        Largest       Std. dev.      1.027117
75%     2.608496       3.995023
90%     3.263123       4.052053       Variance        1.05497
95%     3.605864       4.097698       Skewness       .4144978
99%     4.852746       5.607795       Kurtosis       3.673819

.   twoway (scatter tau_j mu_j) ///
>     (function y=x, range(`r(min)' `r(max)') lc(red%50)), ///
>     xtitle("{&mu}{sub:j}") ytitle("`=ustrunescape("\u03C4\u0302")'{sub:j}") ///
>     legend(order(2 "45-degree line") ring(0) position(11))

.   graph export output/Fig_1_8.png, replace
(file output/Fig_1_8.png not found)
file output/Fig_1_8.png saved as PNG format

.         
. restore 

. 
. 
. 
. 
. * Q1.9 =======================================
. set seed 1234

. qui sample_phi, phi(0)

. gen tau_j = j*w

. 
. 
. local n_j = 10

. local J = 100

. 
. 
. ** estimate sigma^2_Y by taking the within-village variance
. qui reghdfe y, absorb(j tau_j)

. scalar sigma2_y_hat = `e(rmse)'^2 

. 
. 
. ** estimate grand mean and sigma^2_mu
. qui reghdfe y ib0.tau_j , absorb(j) cluster(j) resid

. regsave //*j

. rename coef tau_j_hat

. 
. drop if var == "0b.tau_j" | var == "_cons"
(2 observations deleted)

. drop if ustrpos(var, "o")
(0 observations deleted)

. gen j = subinstr(var, ".tau_j", "", .)

. destring j, replace
j: all characters numeric; replaced as byte

. keep j tau_j_hat

. 
. merge 1:1 j using tmp/mu, nogen // merge the true means to the estimates
(variable j was byte, now float to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               100  
    -----------------------------------------

. 
. sum tau_j_hat

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   tau_j_hat |        100    1.910591    1.220271  -1.208926   4.851578

. scalar grandmean = `r(mean)'

. dis "Grand mean: `=grandmean'"
Grand mean: 1.910590518824756

. 
. 
. qui reg tau_j_hat

. scalar sigma2_0_hat = `e(rmse)'^2 - 4 * `=sigma2_y_hat'/`n_j'

. 
. scalar lambda = `=sigma2_0_hat'/(`=sigma2_0_hat' + 4 * `=sigma2_y_hat'/`n_j')

. dis `=lambda'
.66809722

. 
. gen mu_j_hat = `=lambda' * tau_j_hat + (1 - `=lambda') * `=grandmean'

. 
. egen mse_tau_j_hat = total(1/`n_j'*(tau_j_hat - mu_j)^2)

. egen mse_mu_j_hat = total(1/`n_j'*(mu_j_hat - mu_j)^2)

. sum mse*

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
mse_tau_j_~t |        100     5.19875           0    5.19875    5.19875
mse_mu_j_hat |        100    3.676587           0   3.676587   3.676587

. 
. 
. 
. 
. * scatter
. twoway (pcarrow tau_j_hat mu_j mu_j_hat mu_j, mc(black%50)lc(black%50)) ///
>   (scatter tau_j_hat mu_j, m(o) mc(black%40) msize(0.8)) ///
>   (pci -1.5 -1.5 5 5, lp(dash) lc(red%40)) ///
>   (function y=`=grandmean', range(-2 5)), ///
>   xlabel(-2(2)5) ylabel(-2(2)5) ///
>   /// xscale(r(-2 5)) yscale(r(-2 5)) ///
>   legend(order(1 "Shrinkage: `=ustrunescape("\u03C4\u0302")'{subscript:j} → {&mu}`=ustrunescape("\u0302")'{subscript:j}" ///y-bar{subscript:j} → {&mu}-hat{subscript:j}" ///
>     2 "`=ustrunescape("\u03C4\u0302")'{subscript:j}" ///"y-bar{subscript:j}" ///
>     3 "45-degree line" ///
>     4 "Grand mean, `=ustrunescape("\u03C4\u0305")'") ///
>     ring(0) position(11)) ///
>   ytitle("`=ustrunescape("\u03C4\u0302")'{subscript:j} → {&mu}`=ustrunescape("\u0302")'{subscript:j}") xtitle("{&mu}{subscript:j}")

. graph export output/Fig_1_9_1.png, replace
(file output/Fig_1_9_1.png not found)
file output/Fig_1_9_1.png saved as PNG format

. 
. 
. ** order by mu_j - mu_j_hat
. sort mu_j_hat

. gen ordering = _n

. twoway (pcarrow tau_j_hat ordering mu_j_hat ordering, mc(black%50)lc(black%50)) ///
>   (function y=`=grandmean', range(0 100) lcolor(green%50)), ///
>   legend(order(1 "Shrinkage: `=ustrunescape("\u03C4\u0302")'{subscript:j} → {&mu}`=ustrunescape("\u0302")'{subscript:j}" 2 "Grand mean, `=ustrunescape("\u03C4\u0305")'") ///
>     ring(0) position(11)) ///
>   ytitle("`=ustrunescape("\u03C4\u0302")'{subscript:j} → {&mu}`=ustrunescape("\u0302")'{subscript:j}") xtitle("Villages Ordered by `=ustrunescape("\u03C4\u0302")'{subscript:j}") xlabel("")

. graph export output/Fig_1_9_2.png, replace
(file output/Fig_1_9_2.png not found)
file output/Fig_1_9_2.png saved as PNG format

. 
. 
. 
. log close
      name:  <unnamed>
       log:  C:\Users\chadi\OneDrive - Handelshögskolan i Stockholm\SU\EC38003\assignments\PS4\Econometrics II - Problem Set 4 - Suggested Solutions\log/PS4_Q1.log
  log type:  text
 closed on:   9 May 2024, 13:27:08
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
