############################################################################################################################/
##################### Problem Set: Week 7 ###############################################################################
############################################################################################################################/
# 14.750x: Political Economy and Economic Development
# Author: Raimundo Eyzaguirre (reyzaguirre1@uc.cl)
############################################################################################################################/

#**************************************************************************************************************************/
# 0. Initial adjustment and necessary package loading ----------------------------------------------------------------
#**************************************************************************************************************************/

options(scipen=999)
options(max.print = 99999999)
rm(list=(ls()))

library(rio)
library(dplyr)
library(tidyr)
library(ggplot2)

getwd()
data <- import("votingData.rdata")


#*****************************************************************************/
# 1.a  ----------------------------------------------------------------
#*****************************************************************************/


lm1 <-lm (votePercent~campaignDonation, data =data)

summary(lm1)


#*****************************************************************************/
# 1.b  ----------------------------------------------------------------
#*****************************************************************************/

sd<-sd(data$campaignDonation)
sd


#*****************************************************************************/
# 1.c  ----------------------------------------------------------------
#*****************************************************************************/

effect<-lm1$coefficients[2]

sd*effect

100*sd*effect



#*****************************************************************************/
# 2. ----------------------------------------------------------------
#*****************************************************************************/


ggplot(data=data, aes(x=campaignDonation, y=votePercent))+
  geom_point()+ theme(legend.position = "none")  



#*****************************************************************************/
# 3.a  ----------------------------------------------------------------
#*****************************************************************************/


lm2 <-lm (votePercent~campaignDonation+factor(county), data =data)

summary(lm2)



#*****************************************************************************/
# 3.b ----------------------------------------------------------------
#*****************************************************************************/


effect2<-lm2$coefficients[2]

sd*effect2

100*sd*effect2



#*****************************************************************************/
# 3.c ----------------------------------------------------------------
#*****************************************************************************/


data = data %>% group_by (county) %>% mutate(demeaned_votePercent = votePercent - mean(votePercent))

data = data %>% group_by (county) %>% mutate(demeaned_campaignDonation = campaignDonation - mean(campaignDonation))

lm3 <-lm (demeaned_votePercent~demeaned_campaignDonation, data =data)

summary(lm3)



#*****************************************************************************/
# 4. ----------------------------------------------------------------
#*****************************************************************************/


# This grap is not necessary, but look at what happens when you add colors for each county!
ggplot(data=data, aes(x=campaignDonation, y=votePercent, col=factor(county)))+
  geom_point()+ theme(legend.position = "none")  
