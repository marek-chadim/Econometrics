
. *-----------------------------------------------------------------------------
. *a
. cap program drop montecarlo

. program define montecarlo, rclass
  1.         clear
  2.         set obs 20
  3.         gen e = rnormal(0, sqrt(3))
  4.         gen z = rnormal()
  5.         gen u = rnormal()
  6.         gen x = z + e + u
  7.         gen y = x + e
  8.         reg x z
  9.         return scalar b1 = _b[z]
 10.         return scalar rss  = `e(rss)'
 11.         test _b[z] = 0
 12.         return scalar F = `r(F)'        
 13.         ivreg y (x = z)
 14.         return scalar b2 = _b[x]        
 15.         gen xtilde = z
 16.         reg y xtilde
 17.         return scalar b3 = _b[xtilde]   
 18.         gen ess = (e+u)^2
 19.         sum ess 
 20.         return scalar ess = `r(N)' * `r(mean)'
 21.         drop e z u x y xtilde
 22. end

. simulate rss=r(rss) ess=r(ess) F=r(F) b1=r(b1) b2=r(b2) b3=r(b3), seed(42) reps(10000): montecarlo

      Command: montecarlo
          rss: r(rss)
          ess: r(ess)
            F: r(F)
           b1: r(b1)
           b2: r(b2)
           b3: r(b3)

Simulations (10,000): .........10.........20.........30.........40.........50.........60.........70.........80.........90.........100.........110.........120.........130.........140.........150.........160.........170.........180.........190.........200..
> .......210.........220.........230.........240.........250.........260.........270.........280.........290.........300.........310.........320.........330.........340.........350.........360.........370.........380.........390.........400.........410...
> ......420.........430.........440.........450.........460.........470.........480.........490.........500.........510.........520.........530.........540.........550.........560.........570.........580.........590.........600.........610.........620....
> .....630.........640.........650.........660.........670.........680.........690.........700.........710.........720.........730.........740.........750.........760.........770.........780.........790.........800.........810.........820.........830.....
> ....840.........850.........860.........870.........880.........890.........900.........910.........920.........930.........940.........950.........960.........970.........980.........990.........1,000.........1,010.........1,020.........1,030.........1
> ,040.........1,050.........1,060.........1,070.........1,080.........1,090.........1,100.........1,110.........1,120.........1,130.........1,140.........1,150.........1,160.........1,170.........1,180.........1,190.........1,200.........1,210.........1,
> 220.........1,230.........1,240.........1,250.........1,260.........1,270.........1,280.........1,290.........1,300.........1,310.........1,320.........1,330.........1,340.........1,350.........1,360.........1,370.........1,380.........1,390.........1,4
> 00.........1,410.........1,420.........1,430.........1,440.........1,450.........1,460.........1,470.........1,480.........1,490.........1,500.........1,510.........1,520.........1,530.........1,540.........1,550.........1,560.........1,570.........1,58
> 0.........1,590.........1,600.........1,610.........1,620.........1,630.........1,640.........1,650.........1,660.........1,670.........1,680.........1,690.........1,700.........1,710.........1,720.........1,730.........1,740.........1,750.........1,760
> .........1,770.........1,780.........1,790.........1,800.........1,810.........1,820.........1,830.........1,840.........1,850.........1,860.........1,870.........1,880.........1,890.........1,900.........1,910.........1,920.........1,930.........1,940.
> ........1,950.........1,960.........1,970.........1,980.........1,990.........2,000.........2,010.........2,020.........2,030.........2,040.........2,050.........2,060.........2,070.........2,080.........2,090.........2,100.........2,110.........2,120..
> .......2,130.........2,140.........2,150.........2,160.........2,170.........2,180.........2,190.........2,200.........2,210.........2,220.........2,230.........2,240.........2,250.........2,260.........2,270.........2,280.........2,290.........2,300...
> ......2,310.........2,320.........2,330.........2,340.........2,350.........2,360.........2,370.........2,380.........2,390.........2,400.........2,410.........2,420.........2,430.........2,440.........2,450.........2,460.........2,470.........2,480....
> .....2,490.........2,500.........2,510.........2,520.........2,530.........2,540.........2,550.........2,560.........2,570.........2,580.........2,590.........2,600.........2,610.........2,620.........2,630.........2,640.........2,650.........2,660.....
> ....2,670.........2,680.........2,690.........2,700.........2,710.........2,720.........2,730.........2,740.........2,750.........2,760.........2,770.........2,780.........2,790.........2,800.........2,810.........2,820.........2,830.........2,840......
> ...2,850.........2,860.........2,870.........2,880.........2,890.........2,900.........2,910.........2,920.........2,930.........2,940.........2,950.........2,960.........2,970.........2,980.........2,990.........3,000.........3,010.........3,020.......
> ..3,030.........3,040.........3,050.........3,060.........3,070.........3,080.........3,090.........3,100.........3,110.........3,120.........3,130.........3,140.........3,150.........3,160.........3,170.........3,180.........3,190.........3,200........
> .3,210.........3,220.........3,230.........3,240.........3,250.........3,260.........3,270.........3,280.........3,290.........3,300.........3,310.........3,320.........3,330.........3,340.........3,350.........3,360.........3,370.........3,380.........
> 3,390.........3,400.........3,410.........3,420.........3,430.........3,440.........3,450.........3,460.........3,470.........3,480.........3,490.........3,500.........3,510.........3,520.........3,530.........3,540.........3,550.........3,560.........3
> ,570.........3,580.........3,590.........3,600.........3,610.........3,620.........3,630.........3,640.........3,650.........3,660.........3,670.........3,680.........3,690.........3,700.........3,710.........3,720.........3,730.........3,740.........3,
> 750.........3,760.........3,770.........3,780.........3,790.........3,800.........3,810.........3,820.........3,830.........3,840.........3,850.........3,860.........3,870.........3,880.........3,890.........3,900.........3,910.........3,920.........3,9
> 30.........3,940.........3,950.........3,960.........3,970.........3,980.........3,990.........4,000.........4,010.........4,020.........4,030.........4,040.........4,050.........4,060.........4,070.........4,080.........4,090.........4,100.........4,11
> 0.........4,120.........4,130.........4,140.........4,150.........4,160.........4,170.........4,180.........4,190.........4,200.........4,210.........4,220.........4,230.........4,240.........4,250.........4,260.........4,270.........4,280.........4,290
> .........4,300.........4,310.........4,320.........4,330.........4,340.........4,350.........4,360.........4,370.........4,380.........4,390.........4,400.........4,410.........4,420.........4,430.........4,440.........4,450.........4,460.........4,470.
> ........4,480.........4,490.........4,500.........4,510.........4,520.........4,530.........4,540.........4,550.........4,560.........4,570.........4,580.........4,590.........4,600.........4,610.........4,620.........4,630.........4,640.........4,650..
> .......4,660.........4,670.........4,680.........4,690.........4,700.........4,710.........4,720.........4,730.........4,740.........4,750.........4,760.........4,770.........4,780.........4,790.........4,800.........4,810.........4,820.........4,830...
> ......4,840.........4,850.........4,860.........4,870.........4,880.........4,890.........4,900.........4,910.........4,920.........4,930.........4,940.........4,950.........4,960.........4,970.........4,980.........4,990.........5,000.........5,010....
> .....5,020.........5,030.........5,040.........5,050.........5,060.........5,070.........5,080.........5,090.........5,100.........5,110.........5,120.........5,130.........5,140.........5,150.........5,160.........5,170.........5,180.........5,190.....
> ....5,200.........5,210.........5,220.........5,230.........5,240.........5,250.........5,260.........5,270.........5,280.........5,290.........5,300.........5,310.........5,320.........5,330.........5,340.........5,350.........5,360.........5,370......
> ...5,380.........5,390.........5,400.........5,410.........5,420.........5,430.........5,440.........5,450.........5,460.........5,470.........5,480.........5,490.........5,500.........5,510.........5,520.........5,530.........5,540.........5,550.......
> ..5,560.........5,570.........5,580.........5,590.........5,600.........5,610.........5,620.........5,630.........5,640.........5,650.........5,660.........5,670.........5,680.........5,690.........5,700.........5,710.........5,720.........5,730........
> .5,740.........5,750.........5,760.........5,770.........5,780.........5,790.........5,800.........5,810.........5,820.........5,830.........5,840.........5,850.........5,860.........5,870.........5,880.........5,890.........5,900.........5,910.........
> 5,920.........5,930.........5,940.........5,950.........5,960.........5,970.........5,980.........5,990.........6,000.........6,010.........6,020.........6,030.........6,040.........6,050.........6,060.........6,070.........6,080.........6,090.........6
> ,100.........6,110.........6,120.........6,130.........6,140.........6,150.........6,160.........6,170.........6,180.........6,190.........6,200.........6,210.........6,220.........6,230.........6,240.........6,250.........6,260.........6,270.........6,
> 280.........6,290.........6,300.........6,310.........6,320.........6,330.........6,340.........6,350.........6,360.........6,370.........6,380.........6,390.........6,400.........6,410.........6,420.........6,430.........6,440.........6,450.........6,4
> 60.........6,470.........6,480.........6,490.........6,500.........6,510.........6,520.........6,530.........6,540.........6,550.........6,560.........6,570.........6,580.........6,590.........6,600.........6,610.........6,620.........6,630.........6,64
> 0.........6,650.........6,660.........6,670.........6,680.........6,690.........6,700.........6,710.........6,720.........6,730.........6,740.........6,750.........6,760.........6,770.........6,780.........6,790.........6,800.........6,810.........6,820
> .........6,830.........6,840.........6,850.........6,860.........6,870.........6,880.........6,890.........6,900.........6,910.........6,920.........6,930.........6,940.........6,950.........6,960.........6,970.........6,980.........6,990.........7,000.
> ........7,010.........7,020.........7,030.........7,040.........7,050.........7,060.........7,070.........7,080.........7,090.........7,100.........7,110.........7,120.........7,130.........7,140.........7,150.........7,160.........7,170.........7,180..
> .......7,190.........7,200.........7,210.........7,220.........7,230.........7,240.........7,250.........7,260.........7,270.........7,280.........7,290.........7,300.........7,310.........7,320.........7,330.........7,340.........7,350.........7,360...
> ......7,370.........7,380.........7,390.........7,400.........7,410.........7,420.........7,430.........7,440.........7,450.........7,460.........7,470.........7,480.........7,490.........7,500.........7,510.........7,520.........7,530.........7,540....
> .....7,550.........7,560.........7,570.........7,580.........7,590.........7,600.........7,610.........7,620.........7,630.........7,640.........7,650.........7,660.........7,670.........7,680.........7,690.........7,700.........7,710.........7,720.....
> ....7,730.........7,740.........7,750.........7,760.........7,770.........7,780.........7,790.........7,800.........7,810.........7,820.........7,830.........7,840.........7,850.........7,860.........7,870.........7,880.........7,890.........7,900......
> ...7,910.........7,920.........7,930.........7,940.........7,950.........7,960.........7,970.........7,980.........7,990.........8,000.........8,010.........8,020.........8,030.........8,040.........8,050.........8,060.........8,070.........8,080.......
> ..8,090.........8,100.........8,110.........8,120.........8,130.........8,140.........8,150.........8,160.........8,170.........8,180.........8,190.........8,200.........8,210.........8,220.........8,230.........8,240.........8,250.........8,260........
> .8,270.........8,280.........8,290.........8,300.........8,310.........8,320.........8,330.........8,340.........8,350.........8,360.........8,370.........8,380.........8,390.........8,400.........8,410.........8,420.........8,430.........8,440.........
> 8,450.........8,460.........8,470.........8,480.........8,490.........8,500.........8,510.........8,520.........8,530.........8,540.........8,550.........8,560.........8,570.........8,580.........8,590.........8,600.........8,610.........8,620.........8
> ,630.........8,640.........8,650.........8,660.........8,670.........8,680.........8,690.........8,700.........8,710.........8,720.........8,730.........8,740.........8,750.........8,760.........8,770.........8,780.........8,790.........8,800.........8,
> 810.........8,820.........8,830.........8,840.........8,850.........8,860.........8,870.........8,880.........8,890.........8,900.........8,910.........8,920.........8,930.........8,940.........8,950.........8,960.........8,970.........8,980.........8,9
> 90.........9,000.........9,010.........9,020.........9,030.........9,040.........9,050.........9,060.........9,070.........9,080.........9,090.........9,100.........9,110.........9,120.........9,130.........9,140.........9,150.........9,160.........9,17
> 0.........9,180.........9,190.........9,200.........9,210.........9,220.........9,230.........9,240.........9,250.........9,260.........9,270.........9,280.........9,290.........9,300.........9,310.........9,320.........9,330.........9,340.........9,350
> .........9,360.........9,370.........9,380.........9,390.........9,400.........9,410.........9,420.........9,430.........9,440.........9,450.........9,460.........9,470.........9,480.........9,490.........9,500.........9,510.........9,520.........9,530.
> ........9,540.........9,550.........9,560.........9,570.........9,580.........9,590.........9,600.........9,610.........9,620.........9,630.........9,640.........9,650.........9,660.........9,670.........9,680.........9,690.........9,700.........9,710..
> .......9,720.........9,730.........9,740.........9,750.........9,760.........9,770.........9,780.........9,790.........9,800.........9,810.........9,820.........9,830.........9,840.........9,850.........9,860.........9,870.........9,880.........9,890...
> ......9,900.........9,910.........9,920.........9,930.........9,940.........9,950.........9,960.........9,970.........9,980.........9,990.........10,000 done

. save output/q1, replace
(file output/q1.dta not found)
file output/q1.dta saved

. use output/q1.dta
(simulate: montecarlo)

. sum b2, d //mean .4375127

                            r(b2)
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -6.601207      -2573.869
 5%    -.9167407      -1083.578
10%    -.0187996      -400.8768       Obs              10,000
25%     .6772003      -371.5027       Sum of wgt.      10,000

50%     1.024349                      Mean           .4375127
                        Largest       Std. dev.      29.53724
75%     1.237925       110.6571
90%     1.388073       182.9477       Variance       872.4484
95%     1.484512       281.3055       Skewness      -71.23533
99%     6.741151       434.3859       Kurtosis       5964.476

. sum b3, d //mean 1.008521

                            r(b3)
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -1.085745      -2.265069
 5%    -.4454826      -2.139758
10%    -.1191327      -2.117151       Obs              10,000
25%      .444926      -2.041792       Sum of wgt.      10,000

50%     1.011238                      Mean           1.008521
                        Largest       Std. dev.      .8772596
75%     1.578184       4.565514
90%     2.115397       4.602614       Variance       .7695844
95%     2.443835       4.957342       Skewness       .0145679
99%      3.10289        5.70816       Kurtosis       3.367008

. twoway (kdensity b2) (kdensity b3), legend(order(1 "2SLSx" 2 "2SLSxtilde")) xtitle({&beta}hat) name(a1, replace)

. twoway (kdensity b2 if b2>-6 & b2<6) (kdensity b3), xline(.4375127) xline(1.008521, lp(dash)) ///
> legend(order(1 "mean .4375127" 2 "mean 1.008521")) xtitle(-6 < {&beta}hat < 6) name(a2, replace)

. graph combine a1 a2, col(1)

. graph export "output/a.png", replace
(file output/a.png not found)
file output/a.png saved as PNG format

. 
. *b
. gen absbias = abs(b2 - 1)       

. sum absbias if b1 > 1 //mean .2243988

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     absbias |      5,061    .2243988    .1458173   .0000973   .8774244

. sum absbias if b1 < 1 //mean 2.838942

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     absbias |      4,939    2.838942    41.94204   .0000288   2574.869

. binscatter absbias F, n(50) name(b1, replace)

. binscatter absbias F if F > 10, n(50) name(b2, replace) xtitle(F > 10)

. graph combine b1 b2, col(1)

. graph export "output/b.png", replace
(file output/b.png not found)
file output/b.png saved as PNG format

. 
. *c
. gen ssratio = rss/ess

. sum ssratio  //max .999998

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     ssratio |     10,000    .9003871      .09052   .2800951    .999998

. binscatter rss b1, n(50) name(c1, replace) xtitle("")

. binscatter ess b1, n(50) name(c2, replace) xtitle("")

. binscatter ssratio b1, n(50) name(c3, replace) xtitle({&beta}hat FS)

. graph combine c1 c2 c3, col(1)

. graph export "output/c.png", replace
(file output/c.png not found)
file output/c.png saved as PNG format

. 
. *d
. gen absbiasdesc = -absbias

. sort absbiasdesc

. list b1 in 1/5 //.000352

     +-----------+
     |        b1 |
     |-----------|
  1. |   .000352 |
  2. |  .0006664 |
  3. | -.0020519 |
  4. |   .002021 |
  5. |  .0028975 |
     +-----------+

. sort absbias

. list b1 in 1/5 //.7315149 (1.049486)

     +----------+
     |       b1 |
     |----------|
  1. | .7315149 |
  2. | 1.049486 |
  3. | .7349517 |
  4. | .6962473 |
  5. | 1.589344 |
     +----------+

. binscatter absbias b1, n(50) name(d1, replace) xtitle("")

. binscatter F b1, n(50) name(d2, replace) xtitle({&beta}hat FS)

. binscatter absbias b1 if b1 > 0.5, n(50) name(d3, replace) xtitle("")

. binscatter F b1 if b1 > 0.5, n(50) name(d4, replace) xtitle({&beta}hat FS > .5)                                                         

. graph combine d1 d3 d2 d4

. graph export "output/d.png", replace
(file output/d.png not found)
file output/d.png saved as PNG format

. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. log close
      name:  <unnamed>
       log:  C:\Users\chadi\OneDrive - Handelsh√∂gskolan i Stockholm\SU\EC38003\assignments\PS3\log/q1.log
  log type:  text
 closed on:  27 Apr 2024, 06:05:07
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
